(function(f){function d(){}function v(F){c=[F]}function o(J,G,H,I){try{I=J&&J.apply(G.context||G,H)}catch(F){I=!1}return I}function n(F){return/\?/.test(F)?"&":"?"}var p="async",t="charset",r="",D="error",u="insertBefore",s="_jqjsp",A="on",g=A+"click",k=A+D,q=A+"load",y=A+"readystatechange",b="readyState",C="removeChild",j="<script>",z="success",B="timeout",e=window,a=f.Deferred,h=f("head")[0]||document.documentElement,x={},m=0,c,l={callback:s,url:location.href},w=e.opera;function E(K){K=f.extend({},l,K);var I=K.success,P=K.error,H=K.complete,Y=K.dataFilter,aa=K.callbackParameter,Q=K.callback,Z=K.cache,G=K.pageCache,J=K.charset,L=K.url,ac=K.data,S=K.timeout,O,W=0,U=d,R,N,F,ab,M,V;a&&a(function(ad){ad.done(I).fail(P);I=ad.resolve;P=ad.reject}).promise(K);K.abort=function(){!(W++)&&U()};if(o(K.beforeSend,K,[K])===!1||W){return K}L=L||r;ac=ac?((typeof ac)=="string"?ac:f.param(ac,K.traditional)):r;L+=ac?(n(L)+ac):r;aa&&(L+=n(L)+encodeURIComponent(aa)+"=?");!Z&&!G&&(L+=n(L)+"_"+(new Date()).getTime()+"=");L=L.replace(/=\?(&|$)/,"="+Q+"$1");function X(ad){if(!(W++)){U();G&&(x[L]={s:[ad]});Y&&(ad=Y.apply(K,[ad]));o(I,K,[ad,z]);o(H,K,[K,z])}}function T(ad){if(!(W++)){U();G&&ad!=B&&(x[L]=ad);o(P,K,[K,ad]);o(H,K,[K,ad])}}if(G&&(O=x[L])){O.s?X(O.s[0]):T(O)}else{e[Q]=v;ab=f(j)[0];ab.id=s+m++;if(J){ab[t]=J}w&&w.version()<11.6?((M=f(j)[0]).text="document.getElementById('"+ab.id+"')."+k+"()"):(ab[p]=p);if(y in ab){ab.htmlFor=ab.id;ab.event=g}ab[q]=ab[k]=ab[y]=function(ad){if(!ab[b]||!/i/.test(ab[b])){try{ab[g]&&ab[g]()}catch(ae){}ad=c;c=0;ad?X(ad[0]):T(D)}};ab.src=L;U=function(ad){V&&clearTimeout(V);ab[y]=ab[q]=ab[k]=null;h[C](ab);M&&h[C](M)};h[u](ab,(F=h.firstChild));M&&h[u](M,F);V=S>0&&setTimeout(function(){T(B)},S)}return K}E.setup=function(F){f.extend(l,F)};f.jsonp=E})(jQuery);!function(d){var b='[data-toggle="dropdown"]',a=function(f){var e=d(f).on("click.dropdown.data-api",this.toggle);d("html").on("click.dropdown.data-api",function(){e.parent().removeClass("open")})};a.prototype={constructor:a,toggle:function(k){var j=d(this),h,f,g;if(j.is(".disabled, :disabled")){return}f=j.attr("data-target");if(!f){f=j.attr("href");f=f&&f.replace(/.*(?=#[^\s]*$)/,"")}h=d(f);h.length||(h=j.parent());g=h.hasClass("open");c();if(!g){h.toggleClass("open")}return false}};function c(){d(b).parent().removeClass("open")}d.fn.dropdown=function(e){return this.each(function(){var g=d(this),f=g.data("dropdown");if(!f){g.data("dropdown",(f=new a(this)))}if(typeof e=="string"){f[e].call(g)}})};d.fn.dropdown.Constructor=a;d(function(){d("html").on("click.dropdown.data-api",c);d("body").on("click.dropdown",".dropdown form",function(f){f.stopPropagation()}).on("click.dropdown.data-api",b,a.prototype.toggle)})}(window.jQuery);!function(a){var b=function(d,c){this.$element=a(d);this.options=a.extend({},a.fn.collapse.defaults,c);if(this.options.parent){this.$parent=a(this.options.parent)}this.options.toggle&&this.toggle()};b.prototype={constructor:b,dimension:function(){var c=this.$element.hasClass("width");return c?"width":"height"},show:function(){var f,c,e,d;if(this.transitioning){return}f=this.dimension();c=a.camelCase(["scroll",f].join("-"));e=this.$parent&&this.$parent.find("> .accordion-group > .in");if(e&&e.length){d=e.data("collapse");if(d&&d.transitioning){return}e.collapse("hide");d||e.data("collapse",null)}this.$element[f](0);this.transition("addClass",a.Event("show"),"shown");this.$element[f](this.$element[0][c])},hide:function(){var c;if(this.transitioning){return}c=this.dimension();this.reset(this.$element[c]());this.transition("removeClass",a.Event("hide"),"hidden");this.$element[c](0)},reset:function(c){var d=this.dimension();this.$element.removeClass("collapse")[d](c||"auto")[0].offsetWidth;this.$element[c!==null?"addClass":"removeClass"]("collapse");return this},transition:function(g,d,e){var f=this,c=function(){if(d.type=="show"){f.reset()}f.transitioning=0;f.$element.trigger(e)};this.$element.trigger(d);if(d.isDefaultPrevented()){return}this.transitioning=1;this.$element[g]("in");a.support.transition&&this.$element.hasClass("collapse")?this.$element.one(a.support.transition.end,c):c()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};a.fn.collapse=function(c){return this.each(function(){var f=a(this),e=f.data("collapse"),d=typeof c=="object"&&c;if(!e){f.data("collapse",(e=new b(this,d)))}if(typeof c=="string"){e[c]()}})};a.fn.collapse.defaults={toggle:true};a.fn.collapse.Constructor=b;a(function(){a("body").on("click.collapse.data-api","[data-toggle=collapse]",function(h){var g=a(this),c,f=g.attr("data-target")||h.preventDefault()||(c=g.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,""),d=a(f).data("collapse")?"toggle":g.data();a(f).collapse(d)})})}(window.jQuery);window.GameEngine=function(){this.username="";this.n_tweets=7;this.fetch_attempts=0;this.max_fetch_attempts=15;this.following_ids=[];this.data=[];this.answers=[];this.start=function(b,a){this.username=b;this.twitterCurrentUser=a;if(a){this.loadDataUsingTwitterAnywhere()}else{this.loadDataUsingPublicAPI()}};this.addAnswer=function(a,c){answer=this.findAnswerByUser(a);if(answer){this.removeAnswer(answer)}answer=this.findAnswerByTweet(c);if(answer){this.removeAnswer(answer)}this.answers.push({user_id:a,tweet_id:c});var b=this.findDataByUser(a).user;$(this).trigger("addAnswer",{tweet_id:c,user:b})};this.findAnswerByUser=function(a){var b=null;$.each(this.answers,function(c,d){if(d.user_id==a){b=d;return false}});return b};this.findAnswerByTweet=function(a){var b=null;$.each(this.answers,function(c,d){if(d.tweet_id==a){b=d;return false}});return b};this.removeAnswer=function(b){var a=b.tweet_id;this.answers.splice(this.answers.indexOf(b),1);$(this).trigger("removeAnswer",b)};this.answersReady=function(){return(this.answers.length==this.n_tweets)};this.grade=function(){var b=0;var a=this;$.each(this.answers,function(c,e){var d=a.findDataByTweet(e.tweet_id);if(d.user.id==e.user_id){b++;$(a).trigger("correctAnswer",{tweet_id:e.tweet_id})}else{$(a).trigger("incorrectAnswer",{tweet_id:e.tweet_id,correct_user:d.user})}});return b};this.loadDataUsingTwitterAnywhere=function(){var c=this;var e=30;var d=[];var b={count:e};var a=localStorage.getItem(this.username+"_last_tweet_id");if(a){b.max_id=a}this.twitterCurrentUser.homeTimeline(b).each(function(g){if(typeof c.timeOutId=="number"){window.clearTimeout(c.timeOutId);delete c.timeOutId}var f={user:{id:g.user.attributes.id,name:g.user.attributes.name,username:g.user.attributes.screen_name,description:g.user.attributes.description,avatar_url:g.user.attributes.profile_image_url},tweets:[{id:g.id,text:g.text}]};d.push(f);if(d.length>=e){c.chooseRandomFromData(d)}else{c.timeOutId=window.setTimeout(c.chooseRandomFromData.bind(c),1000,d)}})};this.chooseRandomFromData=function(a){if(this.fetch_attempts>=a.length){this.updateLocalStorage(a);$(this).trigger("fetchAttemptsLimit");return 0}this.fetch_attempts++;var c=Math.floor((Math.random()*a.length));var b=a[c];if(b.tweets[0].text[0]!="@"&&!this.findDataByUser(b.user.id)){this.data.push(b)}if(this.data.length>=this.n_tweets){this.updateLocalStorage(a);$(this).trigger("dataLoaded")}else{this.chooseRandomFromData(a)}};this.updateLocalStorage=function(b){var d=b[b.length-1].tweets[0].id;var c=localStorage.getItem(this.username+"_last_tweet_id");var a=localStorage.getItem(this.username+"_pages");if(a){a=parseInt(a)}else{a=-1}localStorage.setItem(this.username+"_last_tweet_id",d);localStorage.setItem(this.username+"_pages",a+1);if(d==c||a>20){localStorage.removeItem(this.username+"_last_tweet_id");localStorage.setItem(this.username+"_pages",0)}};this.loadDataUsingPublicAPI=function(){var b=this;var a="https://api.twitter.com/1/friends/ids.json?callback=?&screen_name="+this.username;$.jsonp({url:a,success:function(c){b.following_ids=c.ids;b.loadData()},error:function(d){var c="https://api.twitter.com/1/account/rate_limit_status.json?callback=?";$.jsonp({url:c,success:function(e){if(e.remaining_hits==0){$(b).trigger("rateLimitReached")}else{$(b).trigger("loadFollowingError")}},error:function(){$(b).trigger("loadFollowingError")}})}})};this.loadData=function(){if(this.fetch_attempts>=this.max_fetch_attempts){$(this).trigger("fetchAttemptsLimit");return}else{this.fetch_attempts++}if(this.data.length<this.n_tweets){var a=this.getRandomUserId();var b=this;user_tweets_url="https://api.twitter.com/1/statuses/user_timeline.json?callback=?&count=50&user_id="+a;$.jsonp({url:user_tweets_url,success:function(c){var d=b.getUserData(c);if(d.tweets.length>0){b.data.push(d)}},complete:function(c){b.loadData()}})}else{$(this).trigger("dataLoaded")}};this.getUserData=function(a){var b={user:{},tweets:[]};b.user={id:a[0].user.id,name:a[0].user.name,username:a[0].user.screen_name,description:a[0].user.description,avatar_url:a[0].user.profile_image_url};$.each(a,function(c,d){if(d.text[0]!="@"){b.tweets.push({id:d.id,text:d.text})}});return b};this.findDataByUser=function(a){var b=null;$.each(this.data,function(c,d){if(d.user.id==a){b=d;return false}});return b};this.findDataByTweet=function(a){var b=null;$.each(this.data,function(c,d){$.each(d.tweets,function(e,f){if(f.id==a){b=d;return false}});if(b){return false}});return b};this.getRandomUserId=function(){var a=null;do{var c=Math.floor((Math.random()*this.following_ids.length));a=this.following_ids[c];var b=false;for(i=0;i<this.data.length;i++){if(this.data[i].user.id==a){b=true;break}}}while(b);return a}};Array.prototype.shuffle=function(){var a=this.length;var c=a;while(c--){var d=parseInt(Math.random()*a);var b=this[c];this[c]=this[d];this[d]=b}};window.GameUI=function(a){this.gameEngine;this.start=function(){this.gameEngine=new GameEngine(this);$(window).on("hashchange",{gameUI:this},this.route);ge=this.gameEngine;$(ge).on("rateLimitReached",{gameUI:this},this.showRateLimitMessage);$(ge).on("loadFollowingError",{gameUI:this},this.showErrorMessage);$(ge).on("fetchAttemptsLimit",{gameUI:this},this.showErrorMessage);$(ge).on("dataLoaded",{gameUI:this},this.loadUsers);$(ge).on("addAnswer",{gameUI:this},this.setTweetAuthor);$(ge).on("removeAnswer",{gameUI:this},this.removeAnswer);$(ge).on("correctAnswer",{gameUI:this},this.markCorrect);$(ge).on("incorrectAnswer",{gameUI:this},this.markIncorrect);$("#index .grade button").on("click",{gameUI:this},this.grade);$("#index .tweet").live("click",{gameUI:this},this.showChooseAuthor);$("#chooseAuthor .author").live("click",{gameUI:this},this.addAnswer);$("#index .tweets").empty();$("#chooseAuthor .authors").empty();$("#index .grade button").removeClass("btn-primary").addClass("disabled");$("#index .result").hide();this.showMessage("loading");var b=$("#screen_name").val().replace("@","");this.gameEngine.start(b,a)};this.route=function(b){b.preventDefault();var c=b.data.gameUI;switch(window.location.hash){case"":c.showWindow("index");break;case"#chooseAuthor":c.showWindow("chooseAuthor");break}};this.showWindow=function(b){$("#index").hide();$("#chooseAuthor").hide();switch(b){case"index":$("#index").fadeIn("normal",function(){$('img[src="img/unknown.png"]:first').focus()});break;case"chooseAuthor":$("#chooseAuthor").fadeIn("normal",function(){window.scrollTo(0,0)});break}};this.showChooseAuthor=function(b){b.preventDefault();var c=b.data.gameUI;tweet=$(b.target).closest(".item").clone();c.resetTweet(tweet);$("#chooseAuthor .itemContainer").html(tweet);window.location.hash="chooseAuthor"};this.addAnswer=function(c){c.preventDefault();var e=c.data.gameUI;var b=$(c.target).closest(".author").attr("data-id");var d=$("#chooseAuthor .tweet").attr("data-id");e.gameEngine.addAnswer(b,d);window.location.hash="";if(e.gameEngine.answersReady()){$("#index .grade button").addClass("btn-primary").removeClass("disabled");e.showMessage("none")}};this.showRateLimitMessage=function(b){b.preventDefault();b.data.gameUI.showMessage("rateLimit")};this.showErrorMessage=function(b){b.preventDefault();b.data.gameUI.showMessage("error")};this.showMessage=function(b){$(".loading").hide();$(".error").hide();$(".rateLimit").hide();$("#index .instructions").hide();switch(b){case"loading":$(".loading").show();break;case"error":$(".error").show();break;case"instructions":$("#index .instructions").show();break;case"rateLimit":$(".rateLimit").show();break}};this.loadUsers=function(b){b.preventDefault();var c=b.data.gameUI;c.showMessage("instructions");$.each(c.gameEngine.data,function(e,d){var f=Math.floor((Math.random()*d.tweets.length));tweet='<div class="item tweet row-fluid" data-id="'+d.tweets[f].id+'"><i class="icon-ok"></i><i class="icon-remove"></i><div class="avatar"><img src="img/unknown.png"></div><div class="info"><p><span class="name">????</span> <span class="username"></span></p><p>'+d.tweets[f].text+"</p></div></div>";$(".tweets").append(tweet)});c.gameEngine.data.shuffle();$.each(c.gameEngine.data,function(e,d){author='<div class="item author row-fluid" data-id="'+d.user.id+'"><div class="avatar"><img src="'+d.user.avatar_url+'"></div><div class="info"><p><span class="name">'+d.user.name+'</span> <span class="username">@'+d.user.username+"</span></p><p>"+d.user.description+"</p></div></div>";$(".authors").append(author)});$(".grade").show();$(".adsense").show()};this.setTweetAuthor=function(b,d){b.preventDefault();var e=$('#index .tweet[data-id="'+d.tweet_id+'"]');$(e).find("img").attr("src",d.user.avatar_url);$(e).find(".name").html(d.user.name);$(e).find(".username").html("@"+d.user.username);var c=$('#chooseAuthor .author[data-id="'+d.user.id+'"]');$(c).addClass("selected")};this.removeAnswer=function(b,e){b.preventDefault();var d=b.data.gameUI;var f=$('#index .tweet[data-id="'+e.tweet_id+'"]');d.resetTweet(f);var c=$('#chooseAuthor .author[data-id="'+e.user_id+'"]');$(c).removeClass("selected");$("#index .grade button").removeClass("btn-primary").addClass("disabled");d.showMessage("instructions")};this.resetTweet=function(b){$(b).find("img").attr("src","img/unknown.png");$(b).find(".name").html("????");$(b).find(".username").html("")};this.grade=function(b){b.preventDefault();var e=b.data.gameUI;$("#index .grade").hide();$("#index .tweet").die("click");var c=e.gameEngine.grade();var d=e.gameEngine.n_tweets;$("#index .result .correct").html(c);$("#index .result .total").html(d);share_result=I18n.share_result.replace("{correct}",c).replace("{total}",d);web_intent=$("#index .result .share a");web_intent.attr("href",web_intent.attr("data-url")+encodeURIComponent(share_result));$("#index .result").show()};this.markCorrect=function(b,c){b.preventDefault();var d=$('#index .tweet[data-id="'+c.tweet_id+'"]');$(d).addClass("correct")};this.markIncorrect=function(b,c){b.preventDefault();correct_answer='<div class="correct_answer">'+I18n.correct_answer+": "+c.correct_user.name+" @"+c.correct_user.username+"</div>";var d=$('#index .tweet[data-id="'+c.tweet_id+'"]');$(d).addClass("incorrect");$(d).append(correct_answer)};this.unbindAll=function(){$(window).off("hashchange");ge=this.gameEngine;$(ge).off("rateLimitReached");$(ge).off("loadFollowingError");$(ge).off("fetchAttemptsLimit");$(ge).off("dataLoaded");$(ge).off("addAnswer");$(ge).off("removeAnswer");$(ge).off("correctAnswer");$(ge).off("incorrectAnswer");$("#index .grade button").off("click");$("#index .tweet").die("click");$("#chooseAuthor .author").die("click");delete (this.gameEngine)}};